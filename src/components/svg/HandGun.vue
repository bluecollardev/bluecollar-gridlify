<template>
  <div :class="'gun ' + this.gunId">
    <svg
       xmlns:dc="http://purl.org/dc/elements/1.1/"
       xmlns:cc="http://creativecommons.org/ns#"
       xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
       xmlns:svg="http://www.w3.org/2000/svg"
       xmlns="http://www.w3.org/2000/svg"
       class="drawing"
       version="1.1"
       viewBox="0 0 260 180"
       height="180mm"
       width="260mm">
      <defs
         class="defs3716" />
      <metadata
         class="metadata3719">
        <rdf:RDF>
          <cc:Work
             rdf:about="">
            <dc:format>image/svg+xml</dc:format>
            <dc:type
               rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
            <dc:title></dc:title>
          </cc:Work>
        </rdf:RDF>
      </metadata>
      <g class="currentLayer">
        <g class="guides" id="svg_3">
          <path class="bullet-guide"
                d="M26.081034900344847,34.34393762702179 C15.696778900344846,2.8103655270217898 15.696778900344846,2.8103655270217898 15.696778900344846,2.8103655270217898 "
                style="fill:none;stroke:none;stroke-width:0.02599008px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                id="svg_4"/>
          <ellipse ry="0.35896360874176025" rx="0.3744322955608368" cy="11.342650532722473" cx="10.080294847488403"
                   class="trigger-guide"
                   style="opacity:1;fill:none;fill-opacity:1;stroke:none;stroke-width:0.02603101;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                   id="svg_5"/>
          <ellipse ry="0.38657620549201965" rx="0.4243566393852234" cy="7.559728741645813" cx="25.357125520706177"
                   class="cock-guide"
                   style="opacity:1;fill:none;fill-opacity:1;stroke:none;stroke-width:0.02603101;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                   id="svg_6"/>
        </g>
        <g style="display:inline" class="firearm" id="svg_7">
          <path style="stroke-width:0.08059587;fill:silver" class="bullet"
                d="m31.547919059890745,4.620161553112986 c-1.003798,0.01862 -1.825475,-0.572406 -1.83548,-1.320245 c-0.010010000000000034,-0.7478390000000039 0.795453,-1.36904 1.799251,-1.387655 m0.07523000000000046,-0.11433300000000043 l0.03925000000000011,2.933707 l4.005818,-0.07429000000000056 l-0.03925000000000011,-2.933707 zm4.075176,0.08437000000000022 l0.03497000000000011,2.613888 l0.23548300000000041,-0.0044000000000000315 l-0.03497000000000011,-2.613888 zm0.2939700000000017,-0.16540000000000124 l0.03925000000000011,2.933706 l0.3105340000000003,-0.005800000000000034 l-0.03925000000000011,-2.933706 z"
                id="svg_2"/>
          <rect y="1.648743987083435" x="28.599896669387817" height="2.9228641986846924" width="31.7413387298584"
                class="bore"
                style="display:inline;opacity:1;fill:#ececec;fill-opacity:1;stroke:#000000;stroke-width:0.0224378;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                id="svg_8"/>
          <path
            d="m74.42205824395752,2.63609652702179 c0,0.2871667000000023 -0.21405400000000024,0.51996 -0.478111,0.51996 c-0.264051,0 -0.4781100000000003,-0.23279330000000137 -0.4781100000000003,-0.51996 c0,-0.2871636 0.21405900000000044,-0.5199559 0.4781100000000003,-0.5199559 c0.264057,0 0.478111,0.23279230000000137 0.478111,0.5199559 zm0.451662,0.09030000000000069 c0.12118000000000002,-0.3709053000000003 0.04471000000000055,-0.6223612000000006 -0.15898600000000185,-0.9225594 c-0.11289600000000091,-0.11952600000000134 -0.2470200000000002,-0.2780321 -0.582484,-0.2733522000000003 c-0.4353880000000045,0.02604900000000005 -0.3714010000000003,0.1760620000000004 -0.93035,0.2801967 c-0.461062,0.04713700000000048 -0.8861730000000045,-0.5807883 -1.162295,-0.2410015 c-0.2761280000000003,0.33978380000000297 -0.3578440000000013,4.597885 -0.3578440000000013,4.597885 c-3.694862,3.1908815 3.2525880000000003,5.4484925 2.54024,0.8440038000000006 C74.03419024395751,5.942910527021789 73.23750824395752,5.89019672702179 73.66838524395752,5.519823427021789 C74.33724924395753,4.944882427021789 74.50782924395752,3.6638356270217898 74.87372024395752,2.726396527021789 z"
            style="display:inline;opacity:1;fill:#b3b3b3;fill-opacity:0.54143647;stroke:#000000;stroke-width:0.02603101;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
            class="hammer" id="svg_9"/>
          <path class="trigger"
                d="m54.15036524395752,18.19057262702179 l0.2745820000000003,0.4418050000000023 c0.7946310000000006,-0.3083410000000003 1.41452,-0.6995220000000006 2.046897,-1.380632 c0.515885,-0.6673050000000059 0.7447070000000049,-1.486478 1.210661,-2.167588 l0.299549,-0.09664000000000124 l-0.07488,-1.8638500000000002 c0.478441,-0.05062000000000048 0.7696620000000006,-0.44640400000000297 0.8362310000000006,-0.9388270000000006 c0.3010250000000003,-4.7272362 -1.11751,-2.217434 -1.988291,-1.710819 l-0.7201040000000006,1.1861760000000001 c0.3120300000000003,1.049276 0.7613450000000059,2.457519 0.57413,3.5482139999999998 c-0.13549100000000044,0.7462890000000006 -0.531307,1.3569740000000001 -1.010965,1.9881069999999994 c-0.4451630000000003,0.414192 -0.8903190000000006,0.7317390000000052 -1.447804,0.994058 z"
                style="display:inline;fill:#cccccc;stroke:#000000;stroke-width:0.02599008px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                id="svg_10"/>
          <path class="body"
                d="M30.66245744395752,7.29525622702179 V11.04405962702179 H44.71259924395753 c4.1891490000000005,-0.2082690000000015 5.8718900000000005,3.918057 5.15409,7.419549 c3.671387,2.160771 7.660454,1.7442350000000002 11.437749,1.0934 c1.141419,0.234302 1.259129,0.7419220000000006 1.8357260000000002,1.327673 c1.282634,4.85523 2.565274,9.476158999999999 2.047512,14.214235 l12.455111,0.011530000000000169 c0,0 0.875353,-4.803214 0.473519,-6.231912 c-1.315702,-4.677819 -3.29239,-9.016661 -4.482975,-13.079082 c-0.19831800000000205,-0.676693000000009 -0.129703,-1.240303 0.07862000000000083,-1.9148420000000002 c0.34026600000000257,-1.101744 1.628364,-1.91157 2.533296,-2.25381 c0.6551850000000051,-0.5266850000000006 2.217804,-0.21306700000000137 1.862848,-1.610311 c-0.06146000000000011,-0.5700250000000046 -0.984023,-0.1994220000000018 -1.628142,-0.5889310000000006 c0,0 -0.890457,-0.5246400000000045 -1.414237,-2.1349675 zM57.70368124395752,12.02032662702179 c2.471133,0.559717 4.094977,1.275636 4.342094,3.5535579999999998 c0.03532000000000001,3.137025 -3.706676,3.813899 -5.295262,3.905017 c-2.282851,0.09112000000000131 -5.836577,-0.3644960000000003 -6.319039,-3.592639 c0.11767600000000124,-1.509936 0.5531050000000006,-3.293226 2.8947920000000007,-3.826909 z"
                style="display:inline;fill:rgb(88,88,88);stroke:#000000;stroke-width:0.22599008px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                id="svg_11"/>
          <ellipse ry="0.6638515591621399" rx="0.6707344651222229" cy="18.658836483955383" cx="62.04579257965088"
                   class="mag release"
                   style="opacity:1;fill:#666666;fill-opacity:1;stroke:#000000;stroke-width:0.02603101;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
                   id="svg_12"/>
          <g class="slider-group" id="svg_13">
            <g class="g3706" id="svg_14">
              <g style="fill:#b3b3b3;stroke:#000000" class="slider" id="svg_15">
                <path
                  style="display:inline;fill:#b3b3b3;stroke:#000000;stroke-width:0.26458332px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                  d="m30.66247812603772,7.295262072642988 l-0.07060340923350064,-5.7013136328528 l0.28241457090330296,-0.7029015816948045 c0.41089605765780285,-0.42127273160039996 0.7968299178345083,-0.8011259917884 1.7943362153442,-0.8910470846352045 l0.4022082752292044,1.0563158482704 l0.4610642186073,-0.018137742638399946 c0.3279334326774003,0.9161781275652 1.0053366961209,1.6390667660544 1.508005511166,1.9615737240876 l0.6346984511703091,0.2662444159620003 l15.25968439976277,-0.004328841516000001 c0,0 0.16437439393815,0.2954367180804025 0.3526507434080403,0.4776706145400003 c0,0 3.39501529728735,0.09173218095600212 5.04210275336592,0.0552242399892 c0,0 0.36214426115175297,-0.1397254992816004 0.4361465714618128,-0.6101414300208101 l-0.004326145797600003,-1.8705203137464004 l11.35898524773606,0.02287467303240018 l0.4025753251641013,-1.1391527248224 l0.8390462641638051,0.02287467303240018 l0.21144317776560154,1.11627805179 l1.2560271318111,-0.015600359640000087 c1.8674043695604001,1.2248937477948 2.5366260619359,2.4774011652888 3.3181771759917003,3.6608764748076 l0.9186176466159006,2.3145654378755998 z"
                  class="path6134" stroke-width="0" id="svg_16"/>
                <path
                  style="display:inline;fill:none;stroke:#000000;stroke-width:0.26458332px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                  d="m30.668276207452124,3.9282426503601915 l35.170472590407,-0.05598876092520001 c0.615445608020107,2.1426815018711998 2.6287724070432,3.2913080874816 3.4439155949121,3.5011081293660005 l2.1887131579929,-3.1240071445476 h1.1296573496439002 l1.4120728545165,3.0459071983896 "
                  class="path6248" stroke-width="0" id="svg_17"/>
              </g>
              <path
                d="m67.03217724395752,3.419537927021789 l0.8472440000000045,-0.009760000000000137 c0.1470870000000004,0.17572430000000044 0.1264940000000004,0.3514516000000003 -0.00880000000000009,0.4978874000000034 h-0.838417 c-0.19932200000000044,-0.04321300000000063 -0.226709000000002,-0.3750154000000023 0,-0.48812620000000256 zm3.503706,-0.3416875000000034 l0.11472300000000131,0.9372037 l-2.303444,0.009760000000000137 c-0.22946600000000236,-0.05857300000000057 -0.5560050000000006,-0.6247998000000102 0,-0.9371987 zm0.1676800000000004,-1.1422126000000001 l-0.09708000000000108,0.497888400000005 l0.2118090000000004,1.7377289 l-2.426995,0.019504000000000164 m-1.629876,-1.2406762 l1.7811379999999999,-0.011426000000000087 c0.2200790000000004,-0.451007 0.529667,-0.7751016000000006 1.208261,-1.0604284 c0.312133,-0.04904000000000011 0.5933400000000006,-0.06006700000000011 0.961932,0.07613500000000077 l0.549169,1.325405 l-0.004800000000000053,1.2553903 c-0.475328000000003,0.38955970000000256 -0.774108,0.7400690000000006 -1.302352,0.7586550000000081 c-0.771823,-0.005880000000000064 -1.261229,-0.5681403 -1.556481,-1.1011536 h-1.6122 C66.36297424395752,3.9834814270217898 66.26640124395752,3.3057078270217897 66.76112224395752,2.95009332702179 zm3.90684,0.0006743999999999999 l-2.126934,-0.019505000000000203 "
                style="fill:#666666;stroke:#000000;stroke-width:0.02599008px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                class="safety" id="svg_18"/>
            </g>
            <ellipse
              style="opacity:1;fill:#ff0000;fill-opacity:0.38431373;stroke:#000000;stroke-width:0.02930325;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1"
              class="red-dot" cx="69.12821674346924" cy="6.401989579200745" rx="0.3382243812084198"
              ry="0.38389891386032104" id="svg_19"/>
          </g>
          <path class="slider-remove"
                d="M57.36830324395751,9.95066862702179 C57.032935243957525,10.22402062702179 55.58556424395752,8.44723802702179 57.31534624395752,7.54908802702179 l3.19481,-0.15620000000000137 l0.4412760000000023,-0.3514536000000003 l4.200914,-0.05857300000000057 c0.3471380000000023,0.20826530000000162 0.1647440000000023,0.7289354000000051 0.24711600000000122,1.0934017 l-0.14120800000000044,0.4686025000000003 l-2.983003,0.11715100000000069 c-0.4412740000000023,0.17572500000000021 -0.476575,0.273349 -0.6883850000000051,0.820053 l0.03533000000000011,0.351449 z"
                style="display:inline;fill:rgb(144,144,144);stroke:#000000;stroke-width:0.12599008px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1"
                id="svg_20"/>
        </g>
      </g>
    </svg>
  </div>
</template>

<script>
  import { TweenLite, TimelineLite, CSSPlugin } from 'gsap';

  export default {
    props: {
      introDelay: {
        type: Number,
        default: 1
      }
    },
    data() {
      return {
        tlPullSlider: null,
        gunId: 'gun-' + Math.floor(Math.random() * 10),
        fireGunAudio: null,
        cockGunAudio: null
      }
    },
    methods: {
      p(className) {
        return ['.' + this.gunId, className].join(' ');
      },
      initAudioClips() {
        this.fireGunAudio = new Audio();
        this.fireGunAudio.src = '/audio/40_smith_wesson_single-mike-koenig.mp3';
        this.fireGunAudio.loop = false;

        this.cockGunAudio = new Audio();
        this.cockGunAudio.src = '/audio/gun_cocking_fast-mike_koenig.mp3';
        this.cockGunAudio.loop = false;

      },
      fireWeapon() {
        TweenLite.to(this.p('.trigger'), 0.1, {rotation:-15, transformOrigin:'top right', delay: 0});
        TweenLite.to(this.p('.trigger'), 0, {rotation:0, transformOrigin:'top right', delay: 0.1});
        TweenLite.to(this.p('.hammer'), 0, {rotation:0, transformOrigin:'bottom left', delay: 0.1});

        TweenLite.to(this.p('.bullet'), 0, { x: 0 });
        TweenLite.to(this.p('.bullet'), 0.3, { x: -100 });

        this.fireGunAudio.pause();
        this.fireGunAudio.volume = 0.25;
        this.fireGunAudio.currentTime = 0;
        this.fireGunAudio.play();
      },
      cock() {
        TweenLite.to(this.p('.hammer'), 0, {rotation:64, transformOrigin:'bottom left', ease: Circ.easeOut}, 'start')
      },
      pullSlider() {
        this.tlPullSlider = new TimelineLite();

        this.cockGunAudio.pause();
        this.cockGunAudio.volume = 0.5;
        this.cockGunAudio.currentTime = 0;
        this.cockGunAudio.play();

        this.tlPullSlider
          .to(this.p('.slider-group'), 0.1, {x:'+=10px'},'start')
          .to(this.p('.hammer'), 0.1, {rotation:63.5, transformOrigin:'bottom left', ease: Circ.easeOut}, 'start-=0.1')
          .to(this.p('.slider-group'), 0, {x:'-=10px'});
      },
      shootToThrill() {
        setTimeout(() => {
          setTimeout(() => {
            setTimeout(() => this.pullSlider(), 1000);
            //setTimeout(() => this.cock(), 800);
          });

          setTimeout(() => this.fireWeapon(), 2500);
        }, 100);
      }
    },
    mounted() {
      this.initAudioClips();

      CSSPlugin.defaultSmoothOrigin = true;

      TweenLite.to(this.p('.firearm'), 0.333, { scale: 2 });
      //TweenLite.to(this.p('.bullet'), 0.7, { scale: 2.5 });

      const intro = new TimelineLite();

      intro.to(this.p('.firearm'), 0.5, { rotation: 20, x: '50px', delay: this.introDelay });
      intro.add(() => this.shootToThrill());

      //TweenLite.to(this.p('.hammer'), 0, {rotation:0, transformOrigin:'bottom left', delay: 2});
      //TweenLite.from(this.p('.svg3722'), 0, {rotation:45, transformOrigin:'bottom left', delay: 1})

      this.$el.querySelector(this.p('.trigger')).addEventListener('click', () => {
        //if (interval) clearInterval(interval);
        this.fireWeapon();
      });

      this.$el.querySelector(this.p('.slider')).addEventListener('click', () => {
        //if (interval) clearInterval(interval);
        this.pullSlider();
      });

      this.$el.querySelector(this.p('.hammer')).addEventListener('click', () => {
        //if (interval) clearInterval(interval);
        this.cock();
      });
    }
  }
</script>

<style lang="scss" scoped>
  .gun {
    width: 100%;
    display: -webkit-box;
    display: -webkit-flex;
    display: -ms-flexbox;
    display: -moz-box;
    display: flex;
    -webkit-box-align: center;
    -webkit-align-items: center;
    -ms-flex-align: center;
    -moz-box-align: center;
    align-items: center;
    -webkit-box-pack: end;
    -webkit-justify-content: center;
    justify-content: center;
  }
</style>
